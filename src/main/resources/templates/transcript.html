<html>
<head>
    <title>Monkey notes</title>

</head>
<body>

<div id="topLinks">
    <a href="/">Home</a>
</div>

<div id="sections"></div>

<script th:inline="javascript">
    let fileId = /*[[${fileId}]]*/ {};
</script>

<script>
    function documentLoaded() {

        const container = document.getElementById('sections');

        const topLinks = document.getElementById('topLinks');

        const aForceUpdateAll = document.createElement('a');
        aForceUpdateAll.href = '/transcript/force-update/' + fileId;
        aForceUpdateAll.textContent = 'force update';

        const aGetPDF = document.createElement('a');
        aGetPDF.href = '/transcript/pdf/' + fileId;
        aGetPDF.textContent = 'get pdf';

        const agentLink = document.createElement('a');
        agentLink.href = `/v/agent/${fileId}`;
        agentLink.textContent = 'agent';

        topLinks.appendChild(document.createTextNode(' - '));
        topLinks.appendChild(aForceUpdateAll);
        topLinks.appendChild(document.createTextNode(' - '));
        topLinks.appendChild(aGetPDF);
        topLinks.appendChild(document.createTextNode(' - '));
        topLinks.appendChild(agentLink);

        fetch('/transcript/' + fileId, {
            method: 'GET'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            data.pages.forEach(page => {
                const section = document.createElement('section');

                const h3 = document.createElement('h3');
                h3.textContent = 'Page #' + page.pageNumber;

                const p = document.createElement('p');
                p.innerHTML = page.transcriptHtml;

                const aForceUpdate = document.createElement('a');
                aForceUpdate.href = '/update/transcript/' + fileId + '/' + page.pageNumber;
                aForceUpdate.textContent = 'force update';

                const aViewPage = document.createElement('a');
                aViewPage.href = page.imageUrl;
                aViewPage.textContent = 'view raw page';

                const sectionLinks = document.createElement('div');

                section.appendChild(h3);
                section.appendChild(p);
                section.appendChild(sectionLinks);

                sectionLinks.appendChild(aForceUpdate);
                sectionLinks.appendChild(document.createTextNode(' - '));
                sectionLinks.appendChild(aViewPage);

                container.appendChild(section);
            });
        })
        .catch(error => console.error('Error:', error));
    }
    document.addEventListener('DOMContentLoaded', documentLoaded);
</script>

</body>
</html>